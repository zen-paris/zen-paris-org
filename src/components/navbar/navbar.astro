---
import Container from "@/components/container.astro";
import Dropdown from "./dropdown.astro";
import { Astronav, MenuItems, MenuIcon } from "astro-navbar";
import { getCollection } from "astro:content";

/* ---------------- Pages menu ---------------- */
const pages = await getCollection("pages");
const pageMenuItems = pages
  .filter(p => !p.data.draft)
  .map(p => ({ title: p.data.title, path: `/${p.slug}` }));

/* ---------------- Autour du zen ---------------- */
const blogPosts = await getCollection("autour-du-zen");
const publishedPosts = blogPosts
  .filter(p => !p.data.draft && p.data.publishDate <= new Date())
  .sort((a, b) => new Date(b.data.publishDate) - new Date(a.data.publishDate))
  .map(p => ({ title: p.data.title, path: `/autour-du-zen/${p.slug}` }));

/* ---------------- Zen et sangha ---------------- */
const meditationzenPosts = await getCollection("meditation-zen");
const publishedZenetsanghaPosts = meditationzenPosts
  .filter(p => !p.data.draft && p.data.publishDate <= new Date())
  .sort((a, b) => new Date(b.data.publishDate) - new Date(a.data.publishDate))
  .map(p => ({ title: p.data.title, path: `/meditation-zen/${p.slug}` }));

/* ---------------- Soutras ---------------- */
const soutrasPosts = await getCollection("soutras");
const publishedSoutrasPosts = soutrasPosts
  .filter(p => !p.data.draft && p.data.publishDate <= new Date())
  .sort((a, b) => new Date(b.data.publishDate) - new Date(a.data.publishDate))
  .map(p => ({ title: p.data.title, path: `/soutras/${p.slug}` }));

/* ---------------- Navbar structure ---------------- */
const menuitems = [
  { title: "Méditation", children: publishedZenetsanghaPosts },
  { title: "À propos", children: publishedPosts },
  {
    title: "Stages",
    children: [
      { title: "Par année", path: "/sesshins-et-stages-zen" },
      { title: "Sesshins", path: "/sesshins" },
      { title: "Journées", path: "/journees" },
    ],
  },
  { title: "Soutras", children: publishedSoutrasPosts }, // new menu
];


---

<style>
/* ---------------- HERO ---------------- */
#hero {
  width: 100vw;
  transition: height 0.5s ease-in-out;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  position: relative;
  min-height: 860px;
  height: 70vh;
}


.hero-image {
  object-fit: cover;
  width: 100%;
  height: 100%;
  position: absolute;
  inset: 0;
  z-index: 1;
  display: none;
}


.hero-content {
  transition: opacity 0.5s ease, transform 0.5s ease;
  z-index: 10;
  position: relative;
  padding: 2rem;
  text-align: center;
}

#hero .overlay {
  background-color: rgba(0,0,0,0);
  position: absolute;
  inset: 0;
  z-index: 5;
}

/* shrink effect */
#hero.shrink {
  height: 200px !important;
}

.hero-content.shrink {
  opacity: 0.85;
  transform: translateY(10px);
}

/* ---------------- NAVBAR LIGHT THEME ---------------- */
#navbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background-color: #ffffff; 
  z-index: 50;
}

#navbar a, #navbar .dropdown-title, #navbar button span {
  color: #000000;
}

#navbar a:hover, #navbar .dropdown-title:hover {
  color: #14b8a6; 
}

/* Mobile dropdown */
.mobile-dropdown ul {
  transition: max-height 0.3s ease-in-out;
  overflow: hidden;
}

.mobile-dropdown button span {
  transition: transform 0.3s ease;
}
</style>


<!-- Image for mobile, lazy-loaded -->
<img
  class="hero-image"
  src="/assets/zen-paris-meditation-zazen-paris-kosen-deshimaru.webp"
  alt="Zen Paris Hero"
  loading="lazy"
/>
  <div class="overlay"></div>

  <div class="hero-content flex flex-col items-center sm:items-start gap-4">
    <a href="/" class="flex flex-col items-center sm:items-start gap-4">
      <img
        src="/assets/logo-kosen-shangha-typo-mono-blanc.svg"
        alt="Logo Kosen Shangha"
        class="h-16 sm:h-20 md:h-24 lg:h-28 w-auto"
      />

      <div class="flex flex-col text-center sm:text-left">
        <h1 class="text-white font-bold leading-tight text-2xl sm:text-3xl md:text-4xl lg:text-5xl">
          Zen Paris, Kosen sangha
        </h1>

        <p class="text-white mt-1 sm:mt-2 leading-tight text-sm sm:text-base md:text-lg lg:text-xl">
          Simplement s&rsquo;asseoir, dans un cadre simple
        </p>
      </div>
    </a>
  </div>
</header>

<!-- ================= NAVBAR (ALWAYS VISIBLE) ================= -->
<nav id="navbar" class="shadow-sm transition-shadow duration-300">
<Container>
  <header
    id="navbar"
    class="fixed top-0 left-0 w-full flex flex-col lg:flex-row justify-between items-center bg-indigo-500 p-4 lg:p-6 shadow-lg z-20 transition-all duration-300"
  >
    <Astronav>
      <div class="flex w-full lg:w-auto items-center justify-between transition-all duration-300">
        <!-- Logo -->
        <a href="/" class="flex items-center gap-2 text-lg text-indigo transition-all duration-300">
          <img 
            src="/assets/logo-kosen-shangha-typo-plein.svg" 
            alt="Logo Zen Paris" 
            class="h-16 w-auto transition-all duration-300"
          />
          <span class="transition-all duration-300 font-bold text-indigo text-xl">
            Zen Paris, Kosen sangha
          </span>
        </a>

        <!-- Mobile burger -->
        <div class="block lg:hidden">
          <MenuIcon class="w-6 h-6 text-indigo" />
        </div>
      </div>

      <!-- Menu items -->
      <MenuItems class="hidden w-full lg:w-auto mt-2 lg:flex lg:mt-0">
        <ul class="flex flex-col lg:flex-row lg:gap-3">
          {menuitems.map((item, index) =>
            <li class="relative">
              {item.children ? (
                <Dropdown
                  title={item.title}
                  children={item.children}
                  lastItem={index === menuitems.length - 1}
                  textClass="text-indigo hover:text-indigo-200"
                />
              ) : (
                <a
                  href={item.path}
                  class="flex lg:px-3 py-2 items-center text-indigo hover:text-indigo-200"
                >
                  {item.title}
                </a>
              )}
              {index < menuitems.length - 1 && <hr class="my-1 border-indigo-300 lg:hidden" />}
            </li>
          )}
        </ul>
      </MenuItems>
    </Astronav>
  </header>
</Container>


<style>
  /* Remove body padding since navbar is fixed */
  body {
    padding-top: 0;
  }

  header a {
    text-decoration: none !important;
  }

  /* Mobile menu HR */
  ul > li > hr {
    border: none;
    border-top: 1px solid #e1e1e1;
    margin: 0.25rem 0;
  }

  @media (min-width: 1024px) {
    ul > li > hr {
      display: none;
    }
  }

  /* Dropdown submenu */
  .dropdown-menu {
    background-color: #0f766e !important;
  }
  .dropdown-menu a,
  .dropdown-menu button {
    color: #fff !important;
  }
  .dropdown-menu a:hover,
  .dropdown-menu button:hover {
    color: #99f6e4 !important;
    background-color: #115e59 !important;
  }

  /* Shrink effect */
  header.scrolled {
    padding: 0.5rem 1rem !important;
  }
  header.scrolled img {
    height: 48px !important;
  }
  header.scrolled a {
    font-size: 0.9rem !important;
  }
</style>

<script>
  window.addEventListener("scroll", () => {
    const navbar = document.getElementById("navbar");
    if (window.scrollY > 50) {
      navbar.classList.add("scrolled");
    } else {
      navbar.classList.remove("scrolled");
    }
  });
</script>
</nav>


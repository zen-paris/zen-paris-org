---
import Container from "@/components/container.astro";
import Dropdown from "./dropdown.astro";
import { Astronav, MenuItems, MenuIcon } from "astro-navbar";
import { getCollection } from "astro:content";

/* ---------------- Pages menu ---------------- */
const pages = await getCollection("pages");
const pageMenuItems = pages
  .filter(p => !p.data.draft)
  .map(p => ({
    title: p.data.title,
    path: `/${p.slug}`,
  }));

/* ---------------- Zen et dojo ---------------- */
const blogPosts = await getCollection("zen-et-dojo");
const publishedPosts = blogPosts
  .filter(p => !p.data.draft && p.data.publishDate <= new Date())
  .sort((a, b) => new Date(b.data.publishDate) - new Date(a.data.publishDate))
  .map(p => ({
    title: p.data.title,
    path: `/zen-et-dojo/${p.slug}`,
  }));

/* ---------------- Zen et sangha ---------------- */
const zenetsanghaPosts = await getCollection("zen-et-sangha");
const publishedZenetsanghaPosts = zenetsanghaPosts
  .filter(p => !p.data.draft && p.data.publishDate <= new Date())
  .sort((a, b) => new Date(b.data.publishDate) - new Date(a.data.publishDate))
  .map(p => ({
    title: p.data.title,
    path: `/zen-et-sangha/${p.slug}`,
  }));

/* ---------------- Navbar structure ---------------- */
const menuitems = [
  { title: "Zen et dojo", children: publishedPosts },
  { title: "Zen et sangha", children: publishedZenetsanghaPosts },
  {
    title: "Activités précédentes",
    children: [
      { title: "Par année", path: "/sesshins-et-stages-zen" },
      { title: "Par godo", path: "/godos" },
      { title: "Sesshins", path: "/sesshins" },
      { title: "Matinées", path: "/matinees" },
      { title: "Journées", path: "/journees" },
      { title: "Découverte", path: "/decouverte" },
    ],
  },
];

const heroVideo = "/assets/Zen-Paris-en-tete3.mp4";
---

<Container>
<!-- HERO VIDEO (full width) -->
<header class="relative w-screen h-[70vh] min-h-[420px] overflow-hidden">

  <!-- Video -->
  <video
    class="absolute inset-0 w-screen h-full object-cover"
    src={heroVideo}
    autoplay
    muted
    loop
    playsinline
    preload="auto"
  ></video>

  <!-- Logo bottom-left -->
  <a
    href="/"
    class="absolute bottom-8 left-8 flex items-center gap-4 z-10"
  >
    <img
      src="/public/assets/logo-kosen-shangha-typo-mono-blanc.svg"
      alt="Logo Kosen Shangha"
      class="h-28 w-auto"
    />
<!-- Conteneur pour titre + sous-texte -->
<div class="flex flex-col">

  <!-- Titre principal -->
  <div class="text-white font-bold leading-tight
              text-3xl sm:text-4xl md:text-5xl lg:text-6xl">
    Zen Paris, Kosen sangha
  </div>

  <!-- Sous-texte juste en dessous -->
  <div class="text-white leading-tight mt-2
              text-base sm:text-lg md:text-xl lg:text-2xl">
    Simplement s’asseoir, dans un cadre simple
  </div>

</div>
  </a>

</header>

<!-- NAVBAR (below video, scrolls normally) -->
<nav class="relative z-10 bg-transparent">
  <Container>
    <Astronav class="py-6 flex justify-end">

      <div class="w-full flex flex-col items-end">

        <!-- Menu -->
        <MenuItems class="hidden lg:flex mb-3">
          <ul class="flex gap-4">
            {menuitems.map((item, index) => (
              <li class="relative">
                {item.children ? (
                  <Dropdown
                    title={item.title}
                    children={item.children}
                    lastItem={index === menuitems.length - 1}
                    textClass="text-black hover:text-teal-600"
                    align="right"
                  />
                ) : (
                  <a
                    href={item.path}
                    class="px-3 py-2 text-black hover:text-teal-600"
                  >
                    {item.title}
                  </a>
                )}
              </li>
            ))}
          </ul>
        </MenuItems>

        <!-- Logo + burger -->

      </div>
    </Astronav>
  </Container>
</nav>
</Container>
